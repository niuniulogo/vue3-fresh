
<style>
.main {
    height: calc(100vh - 70px);
    background-color: #F8F9FA;
    overflow-y: auto;
}

.tabbar_footer {
    position: fixed;
    bottom: 0;
    left: 0;
    height: 70px;
    z-index: 999;
}
</style>

<template>
    <div ref="scrollRef" class="main">
        <router-view v-slot="{ Component }">
            <keep-alive :max="10">
                <component :is="Component" />
            </keep-alive>
        </router-view>

        <van-back-top v-if="isShowBackTop" target=".main" bottom="15vh" />
    </div>


    <van-tabbar class="tabbar_footer" v-model="active" @change="onChange" :before-change="onBeforeChange"
        active-color="#40AE36">
        <van-tabbar-item replace to="/home" name="home">
            <template #icon="props">
                <svg v-if="props.active" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                    fill="none" version="1.1" width="24" height="22" viewBox="0 0 25 26">
                    <g>
                        <g>
                            <path
                                d="M12.25,2.842170943040401e-14C5.48451,2.842170943040401e-14,0,5.484510000000029,0,12.250000000000028C0,14.688200000000029,0.768513,16.09570000000003,2.40971,16.44300000000003C2.40971,16.44300000000003,2.64164,16.48560000000003,2.64164,16.48560000000003C3.56453,16.64170000000003,3.92465,16.58790000000003,6.66172,15.879100000000028C6.66172,15.879100000000028,7.38114,15.692200000000028,7.38114,15.692200000000028C9.40026,15.166500000000028,10.7835,14.924700000000028,12.25,14.924700000000028C13.6499,14.924700000000028,14.9738,15.145000000000028,16.8474,15.622200000000028C16.8474,15.622200000000028,18.605,16.07610000000003,18.605,16.07610000000003C20.7479,16.62030000000003,21.0603,16.62740000000003,21.9744,16.465500000000027C23.6953,16.160600000000027,24.5,14.744900000000028,24.5,12.250000000000028C24.5,5.484510000000029,19.0155,2.842170943040401e-14,12.25,2.842170943040401e-14C12.25,2.842170943040401e-14,12.25,2.842170943040401e-14,12.25,2.842170943040401e-14Z"
                                fill="#40AE36" fill-opacity="1" />
                        </g>
                        <g>
                            <path
                                d="M16,3.75C16,1.67893,14.321069999999999,0,12.25,0C10.17893,0,8.5,1.67893,8.5,3.75C8.5,5.82107,10.17893,7.5,12.25,7.5C14.321069999999999,7.5,16,5.82107,16,3.75ZM10.5,3.75C10.5,2.7835,11.2835,2,12.25,2C13.2165,2,14,2.7835,14,3.75C14,4.7165,13.2165,5.5,12.25,5.5C11.2835,5.5,10.5,4.7165,10.5,3.75Z"
                                fill-rule="evenodd" fill="#FFFFFF" fill-opacity="1" />
                        </g>
                        <g>
                            <path
                                d="M12.25,16.5C14.321069999999999,16.5,16,18.17893,16,20.25C16,22.32107,14.321069999999999,24,12.25,24C10.17893,24,8.5,22.32107,8.5,20.25C8.5,18.17893,10.17893,16.5,12.25,16.5C12.25,16.5,12.25,16.5,12.25,16.5Z"
                                fill="#40AE36" fill-opacity="1" />
                        </g>
                    </g>
                </svg>

                <svg v-else xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none"
                    version="1.1" width="24" height="22" viewBox="0 0 25 30">
                    <g>
                        <g>
                            <path
                                d="M24.5,12.25C24.5,5.48451,19.0155,0,12.25,0C5.48451,0,0,5.48451,0,12.25C0,14.6882,0.768513,16.0957,2.40971,16.443L2.64164,16.4856L2.99912,16.5371L3.16824,16.5516L3.33865,16.5575L3.51614,16.554L3.7065,16.54C3.73962,16.5368,3.77352,16.5331,3.80832,16.5289L4.02883,16.4977L4.27667,16.4541L4.71234,16.363L5.05383,16.2841L5.65709,16.1362L7.7767,15.5908C9.58506,15.1354,10.8812,14.9247,12.25,14.9247C13.6499,14.9247,14.9738,15.145,16.8474,15.6222L18.605,16.0761L19.104,16.2012L19.728,16.3496L20.0732,16.4243L20.3718,16.4812L20.632,16.5213L20.8625,16.5462C20.8989,16.5491,20.9344,16.5515,20.9692,16.5532L21.1708,16.5574L21.3636,16.5495C21.4274,16.5449,21.4911,16.5386,21.5562,16.5307L21.757,16.5022L21.9744,16.4655C23.6953,16.1606,24.5,14.7449,24.5,12.25ZM12.25,2C11.2835,2,10.5,2.7835,10.5,3.75C10.5,4.7165,11.2835,5.5,12.25,5.5C13.2165,5.5,14,4.7165,14,3.75C14,2.7835,13.2165,2,12.25,2ZM15.8744,2.78379L15.8342,2.64404C19.7275,4.09737,22.5,7.84987,22.5,12.2499C22.5,13.833,22.2289,14.3594,21.6795,14.4851L21.6255,14.496L21.4984,14.5166L21.3122,14.5361L21.1832,14.5402L21.044,14.536L20.8891,14.5226L20.7131,14.499L20.5107,14.4643L20.2764,14.4174L19.8534,14.3224L19.1273,14.1443L17.197,13.6475C15.248,13.1571,13.8137,12.9246,12.25,12.9246C10.6508,12.9246,9.18682,13.1678,7.16932,13.6814L5.26615,14.171L4.63977,14.324L4.1538,14.4319L3.89324,14.4816L3.67321,14.5151L3.48494,14.5341L3.3197,14.5402C3.29359,14.5402,3.26807,14.5397,3.24297,14.5388L3.09584,14.5283L2.87453,14.496C2.28891,14.3923,2,13.884,2,12.2499C2,7.84987,4.77246,4.09737,8.66561,2.64441C8.55795,2.99387,8.5,3.36512,8.5,3.74991C8.5,5.82098,10.1789,7.49991,12.25,7.49991C14.3211,7.49991,16,5.82098,16,3.74991C16,3.41587,15.9563,3.09203,15.8744,2.78379ZM12.25,16.5C14.3211,16.5,16,18.1789,16,20.25C16,22.3211,14.3211,24,12.25,24C10.1789,24,8.5,22.3211,8.5,20.25C8.5,18.1789,10.1789,16.5,12.25,16.5ZM12.25,18.5C11.2835,18.5,10.5,19.2835,10.5,20.25C10.5,21.2165,11.2835,22,12.25,22C13.2165,22,14,21.2165,14,20.25C14,19.2835,13.2165,18.5,12.25,18.5Z"
                                fill-rule="evenodd" fill="#666666" fill-opacity="1" />
                        </g>
                    </g>
                </svg>
            </template>

            <span>
                主页
            </span>

        </van-tabbar-item>


        <van-tabbar-item replace to="/sorts" name="sorts">
            <template #icon="props">
                <svg v-if="props.active" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                    fill="none" version="1.1" width="24" height="22" viewBox="0 0 25 26">
                    <g>
                        <g>
                            <path
                                d="M10.5,5.25C10.5,2.35051,8.1495,0,5.25,0C2.35051,0,0,2.35051,0,5.25C0,8.1495,2.35051,10.5,5.25,10.5C8.1495,10.5,10.5,8.1495,10.5,5.25ZM22,5.25C22,2.35051,19.6495,0,16.75,0C13.8505,0,11.5,2.35051,11.5,5.25C11.5,8.1495,13.8505,10.5,16.75,10.5C19.6495,10.5,22,8.1495,22,5.25ZM10.5,16.75C10.5,13.8505,8.1495,11.5,5.25,11.5C2.35051,11.5,0,13.8505,0,16.75C0,19.6495,2.35051,22,5.25,22C8.1495,22,10.5,19.6495,10.5,16.75ZM22,16.75C22,13.8505,19.6495,11.5,16.75,11.5C13.8505,11.5,11.5,13.8505,11.5,16.75C11.5,19.6495,13.8505,22,16.75,22C17.9851,22,19.1206,21.5735,20.0172,20.8598L21.8147,22.5117L21.8807,22.5674C22.2871,22.8817,22.8735,22.8376,23.2276,22.4524C23.6014,22.0458,23.5749,21.4132,23.1683,21.0394L21.3187,19.3382C21.7524,18.5744,22,17.6911,22,16.75Z"
                                fill-rule="evenodd" fill="#40AE36" fill-opacity="1" />
                        </g>
                    </g>
                </svg>

                <svg v-else xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none"
                    version="1.1" width="24" height="22" viewBox="0 0 25 30">
                    <g>
                        <g>
                            <path
                                d="M22,16.75C22,13.8505,19.6495,11.5,16.75,11.5C13.8505,11.5,11.5,13.8505,11.5,16.75C11.5,19.6495,13.8505,22,16.75,22C17.9851,22,19.1206,21.5735,20.0172,20.8598L21.8147,22.5117L21.8807,22.5674C22.2871,22.8817,22.8735,22.8376,23.2276,22.4524C23.6014,22.0458,23.5749,21.4132,23.1683,21.0394L21.3187,19.3382C21.7524,18.5744,22,17.6911,22,16.75ZM13.5,16.75C13.5,14.9551,14.9551,13.5,16.75,13.5C18.5449,13.5,20,14.9551,20,16.75C20,17.5186,19.7332,18.2249,19.2872,18.7813L19.2607,18.8052C19.2295,18.8391,19.201,18.8747,19.1764,18.9122C18.5812,19.5797,17.7147,20,16.75,20C14.9551,20,13.5,18.5449,13.5,16.75ZM10.5,16.75C10.5,13.8505,8.1495,11.5,5.25,11.5C2.35051,11.5,0,13.8505,0,16.75C0,19.6495,2.35051,22,5.25,22C8.1495,22,10.5,19.6495,10.5,16.75ZM2,16.75C2,14.9551,3.45507,13.5,5.25,13.5C7.04493,13.5,8.5,14.9551,8.5,16.75C8.5,18.5449,7.04493,20,5.25,20C3.45507,20,2,18.5449,2,16.75ZM10.5,5.25C10.5,2.35051,8.1495,0,5.25,0C2.35051,0,0,2.35051,0,5.25C0,8.1495,2.35051,10.5,5.25,10.5C8.1495,10.5,10.5,8.1495,10.5,5.25ZM2,5.25C2,3.45507,3.45507,2,5.25,2C7.04493,2,8.5,3.45507,8.5,5.25C8.5,7.04493,7.04493,8.5,5.25,8.5C3.45507,8.5,2,7.04493,2,5.25ZM22,5.25C22,2.35051,19.6495,0,16.75,0C13.8505,0,11.5,2.35051,11.5,5.25C11.5,8.1495,13.8505,10.5,16.75,10.5C19.6495,10.5,22,8.1495,22,5.25ZM13.5,5.25C13.5,3.45507,14.9551,2,16.75,2C18.5449,2,20,3.45507,20,5.25C20,7.04493,18.5449,8.5,16.75,8.5C14.9551,8.5,13.5,7.04493,13.5,5.25Z"
                                fill-rule="evenodd" fill="#666666" fill-opacity="1" />
                        </g>
                    </g>
                </svg>
            </template>

            <span>
                分类
            </span>
        </van-tabbar-item>

        <van-tabbar-item replace to="/shopCar" name="shopCar">
            <template #icon="props">
                <svg v-if="props.active" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                    fill="none" version="1.1" width="24" height="22" viewBox="0 0 25 26">
                    <g>
                        <g>
                            <path
                                d="M8.6975,19.521C9.6582,19.521,10.437,20.2998,10.437,21.2605C10.437,22.2212,9.6582,23,8.6975,23C7.73681,23,6.95801,22.2212,6.95801,21.2605C6.95801,20.2998,7.73681,19.521,8.6975,19.521C8.6975,19.521,8.6975,19.521,8.6975,19.521ZM20.2942,19.521C21.2549,19.521,22.0337,20.2998,22.0337,21.2605C22.0337,22.2212,21.2549,23,20.2942,23C19.3335,23,18.5547,22.2212,18.5547,21.2605C18.5547,20.2998,19.3335,19.521,20.2942,19.521C20.2942,19.521,20.2942,19.521,20.2942,19.521ZM3.26525,0.000330157C4.041,0.000443896,4.70377,0.559597,4.83451,1.32425C4.83451,1.32425,5.25809,3.80172,5.25809,3.80172C5.32347,4.1841,5.65492,4.46369,6.04284,4.46369C6.04284,4.46369,23.5337,4.46369,23.5337,4.46369C24.4131,4.46369,25.126,5.17657,25.126,6.05595C25.126,6.13391,25.1202,6.21176,25.1088,6.28888C25.1088,6.28888,23.6093,16.429,23.6093,16.429C23.4939,17.2099,22.8236,17.7883,22.0342,17.7883C22.0342,17.7883,6.94145,17.7883,6.94145,17.7883C6.16567,17.7883,5.5028,17.2292,5.37198,16.4645C5.37198,16.4645,3.01526,2.6886,3.01526,2.6886C2.94985,2.30627,2.61842,2.02672,2.23052,2.02672C2.23052,2.02672,1.01343,2.02672,1.01343,2.02672C0.453729,2.02672,6.85439e-17,1.57299,0,1.01328C-6.0919e-17,0.515843,0.35845,0.102122,0.831145,0.0163254C0.831145,0.0163254,1.01343,0,1.01343,0C1.01343,0,3.26525,0.000330157,3.26525,0.000330157C3.26525,0.000330157,3.26525,0.000330157,3.26525,0.000330157Z"
                                fill="#40AE36" fill-opacity="1" />
                        </g>
                    </g>
                </svg>

                <svg v-else xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none"
                    version="1.1" width="24" height="22" viewBox="0 0 25 30">
                    <g>
                        <g>
                            <path
                                d="M3.26525,0.000330157C4.041,0.000443896,4.70377,0.559597,4.83451,1.32425L5.25809,3.80172C5.32347,4.1841,5.65492,4.46369,6.04284,4.46369L23.5337,4.46369C24.4131,4.46369,25.126,5.17657,25.126,6.05595C25.126,6.13391,25.1202,6.21176,25.1088,6.28888L23.6093,16.429C23.4939,17.2099,22.8236,17.7883,22.0342,17.7883L6.94145,17.7883C6.16567,17.7883,5.5028,17.2292,5.37198,16.4645L3.01526,2.6886C2.94985,2.30627,2.61842,2.02672,2.23052,2.02672L1.01343,2.02672C0.453729,2.02672,0,1.57299,0,1.01328C0,0.515843,0.35845,0.102122,0.831145,0.0163254L1.01343,0L3.26525,0.000330157ZM22.1111,6.49054L6.66161,6.49054C6.22192,6.49054,5.86548,6.84698,5.86548,7.28667L5.87688,7.42093L7.19063,15.0996C7.25604,15.4819,7.58747,15.7614,7.97536,15.7614L20.9771,15.7614C21.3719,15.7614,21.7071,15.4721,21.7647,15.0816L22.8987,7.40298C22.9629,6.96801,22.6624,6.56332,22.2274,6.49908L22.1111,6.49054ZM10.437,21.2605C10.437,20.2998,9.6582,19.521,8.6975,19.521C7.73681,19.521,6.95801,20.2998,6.95801,21.2605C6.95801,22.2212,7.73681,23,8.6975,23C9.6582,23,10.437,22.2212,10.437,21.2605ZM22.0337,21.2605C22.0337,20.2998,21.2549,19.521,20.2942,19.521C19.3335,19.521,18.5547,20.2998,18.5547,21.2605C18.5547,22.2212,19.3335,23,20.2942,23C21.2549,23,22.0337,22.2212,22.0337,21.2605Z"
                                fill-rule="evenodd" fill="#666666" fill-opacity="1" />
                        </g>
                    </g>
                </svg>
            </template>

            <span>
                购物车
            </span>
        </van-tabbar-item>

        <van-tabbar-item replace to="/my" name="my">
            <template #icon="props">
                <svg v-if="props.active" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                    fill="none" version="1.1" width="24" height="22" viewBox="0 0 25 26">
                    <g>
                        <g>
                            <path
                                d="M9.75,0C15.1348,0,19.5,4.36522,19.5,9.75C19.5,15.1348,15.1348,19.5,9.75,19.5C4.36522,19.5,0,15.1348,0,9.75C0,4.36522,4.36522,0,9.75,0ZM12.464,11.6796C11.5358,12.3263,10.6771,12.6351,9.87896,12.6351C9.08077,12.6351,8.22209,12.3263,7.29394,11.6796C6.8408,11.3639,6.21751,11.4753,5.90178,11.9284C5.58605,12.3815,5.69744,13.0048,6.15057,13.3206C7.39428,14.1871,8.64007,14.6351,9.87896,14.6351C11.1178,14.6351,12.3636,14.1871,13.6073,13.3206C14.0605,13.0048,14.1719,12.3815,13.8561,11.9284C13.5404,11.4753,12.9171,11.3639,12.464,11.6796ZM18.5,22.5C18.5,21.9477,18.0523,21.5,17.5,21.5L2.5,21.5C1.94772,21.5,1.5,21.9477,1.5,22.5C1.5,23.0523,1.94772,23.5,2.5,23.5L17.5,23.5C18.0523,23.5,18.5,23.0523,18.5,22.5Z"
                                fill-rule="evenodd" fill="#40AE36" fill-opacity="1" />
                        </g>
                    </g>
                </svg>

                <svg v-else xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none"
                    version="1.1" width="24" height="22" viewBox="0 0 25 30">
                    <g>
                        <g>
                            <path
                                d="M9.75,0C15.1348,0,19.5,4.36522,19.5,9.75C19.5,15.1348,15.1348,19.5,9.75,19.5C4.36522,19.5,0,15.1348,0,9.75C0,4.36522,4.36522,0,9.75,0ZM9.75,2C5.46979,2,2,5.46979,2,9.75C2,14.0302,5.46979,17.5,9.75,17.5C14.0302,17.5,17.5,14.0302,17.5,9.75C17.5,5.46979,14.0302,2,9.75,2ZM13.6073,13.3205C14.0605,13.0047,14.1719,12.3814,13.8561,11.9283C13.5404,11.4752,12.9171,11.3638,12.464,11.6795C11.5358,12.3262,10.6771,12.635,9.87896,12.635C9.08077,12.635,8.22209,12.3262,7.29394,11.6795C6.8408,11.3638,6.21751,11.4752,5.90178,11.9283C5.58605,12.3814,5.69744,13.0047,6.15057,13.3205C7.39428,14.187,8.64007,14.635,9.87896,14.635C11.1178,14.635,12.3636,14.187,13.6073,13.3205ZM18.5,22.5C18.5,21.9477,18.0523,21.5,17.5,21.5L2.5,21.5C1.94772,21.5,1.5,21.9477,1.5,22.5C1.5,23.0523,1.94772,23.5,2.5,23.5L17.5,23.5C18.0523,23.5,18.5,23.0523,18.5,22.5Z"
                                fill-rule="evenodd" fill="#666666" fill-opacity="1" />
                        </g>
                    </g>
                </svg>
            </template>

            <span>
                我的
            </span>
        </van-tabbar-item>

    </van-tabbar>
</template>

<script setup lang="ts">
import { RouterView, onBeforeRouteLeave, useRouter } from 'vue-router'
import { ref, reactive, nextTick, inject } from "vue";
import { onActivated } from 'vue';


const router = useRouter();

const scrollRef = ref<null | HTMLInputElement>(null)
const active = ref('home');

const isShowBackTop = ref(false);
isShowBackTop.value = true;
//记录上一次各个页面的滚动距离
const tabScrollTop: any = reactive({
    'home': 0,
    'sorts': 0,
    'shopCar': 0,
    'my': 0
});



const bus1: any = inject("eventBus1")
bus1.on("swichTab", (tabName: string) => {
    console.log('eventBus1 on event emit!')
    active.value = tabName;
    router.push({ name: tabName, replace: true })
})


onActivated(() => {
    nextTick(() => {
        isShowBackTop.value = true
        setScrollTop()
    })
})
onBeforeRouteLeave((to, from, next) => {
    getScrollTop()
    isShowBackTop.value = false
    next()
})




// tab 切换
const onChange = () => {
    setTimeout(() => {
        setScrollTop()
    }, 0);
}
const onBeforeChange = () => {
    getScrollTop()
    return true;
};


const setScrollTop = () => {

    scrollRef!.value!.scrollTop = tabScrollTop[active.value];
}

const getScrollTop = () => {


    tabScrollTop[active.value] = scrollRef?.value?.scrollTop
}



</script>
